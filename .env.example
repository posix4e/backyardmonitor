# Minimal configuration for the rewrite server
# Copy this file to .env and edit values.

# RTSP or HTTP video source (camera)
RTSP_URL=rtsp://user:pass@camera-host:554/stream

# Optional: force RTSP transport (tcp|udp). Default is tcp for reliability.
# Set to udp only if your camera requires it.
RTSP_TRANSPORT=tcp

# Where to store data (events.db, zones.json, frames/)
DATA_DIR=./data

# Auto-start capture on server startup
AUTO_START=true

# Optional: background analysis scaffold
# Enables periodic task frames under DATA_DIR/analysis for an external
# multimodal analyzer to consume and POST results back.
ANALYSIS_ENABLED=false
# Interval between analysis task frames (seconds)
ANALYSIS_INTERVAL_SEC=15

# Detection method: 'phash' (default) or 'roi_diff'
# roi_diff uses a running-average background and pixel-change ratio per spot.
DETECTOR_METHOD=phash
# ROI diff parameters (only used when DETECTOR_METHOD=roi_diff)
# Exponential moving average rate (0.0-1.0), higher adapts faster
ROI_DIFF_ALPHA=0.05
# Fraction of pixels changed in the spot (0.0-1.0) to consider a change
ROI_DIFF_THRESHOLD=0.02
ROI_DIFF_MIN_PIXELS=600
ROI_DIFF_COOLDOWN_MS=0

# Optional: LLM enrichment for spot_change events
# Enable to classify significance using an LLM (default: OpenAI)
LLM_ENABLED=false
LLM_PROVIDER=openai
LLM_MODEL_FAST=gpt-4o-mini
LLM_TIMEOUT_SEC=20
# Provide provider key in environment (e.g., OPENAI_API_KEY)
OPENAI_API_KEY=

# Category defaults (semantic, independent of ROI/gate geometry)
# Gate: brief occlusions (e.g., car passing), lower stability window, higher ROI change threshold
CATEGORY_GATE_STABLE_MS=400
CATEGORY_GATE_PHASH_MIN_BITS=10
CATEGORY_GATE_ROI_DIFF_THRESHOLD=0.035
CATEGORY_GATE_MIN_PIXELS=800
CATEGORY_GATE_COOLDOWN_MS=3000
CATEGORY_GATE_FLOW_MAG_MIN=0.5
# Parking: slower changes (parked cars), longer stability window, lower ROI change threshold
CATEGORY_PARKING_STABLE_MS=1200
CATEGORY_PARKING_PHASH_MIN_BITS=14
CATEGORY_PARKING_ROI_DIFF_THRESHOLD=0.02
CATEGORY_PARKING_MIN_PIXELS=600
CATEGORY_PARKING_COOLDOWN_MS=45000
## Road (directional flow, e.g., street)
CATEGORY_ROAD_STABLE_MS=800
CATEGORY_ROAD_PHASH_MIN_BITS=16
CATEGORY_ROAD_ROI_DIFF_THRESHOLD=0.08
CATEGORY_ROAD_MIN_PIXELS=1200
CATEGORY_ROAD_COOLDOWN_MS=5000
CATEGORY_ROAD_FLOW_MAG_MIN=1.0
